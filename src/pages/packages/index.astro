---
import PackageCard from "~/components/PackageCard.astro";
import Layout from "~/layouts/CenterLayout.astro";
import { type VPMPackage, type VPMRepository, findLatestPackage, getAllPackages } from "~/utils/vpm";

const allRepos: VPMRepository[] = await Astro.glob("~/../repos/*.json");
const allReleasePackages = getAllPackages(allRepos).filter(p => !p.version.includes('-'));

const allNames = Array.from(new Set(allReleasePackages.map(pkg => pkg.name)));
const packages = allNames
  .map(name => {
    return findLatestPackage(allReleasePackages.filter(p => p.name=== name));
  })
  .filter((p): p is VPMPackage => p ? true : false)
  .sort((a, b) => {
    return a.displayName.localeCompare(b.displayName);
  });
const title = "Packages";
---
<Layout title={title}>
  <h1 class="text-4xl mb-6">{title}</h1>
  {packages.map(pkg => (
    <div class="mb-2">
      <a href={`/packages/${pkg.name}`}>
      <PackageCard pkg={pkg} />
      </a>
    </div>
  ))}
</Layout>
