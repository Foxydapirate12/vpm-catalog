---
import Nav from "~/components/Nav.astro";
import { type VPMPackage, type VPMRepository, findLatestPackage, getAllPackages } from "~/utils/vpm";

const allRepos: VPMRepository[] = await Astro.glob("~/../repos/*.json");
const allReleasePackages = getAllPackages(allRepos).filter(p => !p.version.includes('-'));

const allNames = Array.from(new Set(allReleasePackages.map(pkg => pkg.name)));
const pkgs = allNames
  .map(name => {
    return findLatestPackage(allReleasePackages.filter(p => p.name=== name));
  })
  .filter((p): p is VPMPackage => p ? true : false)
  .sort((a, b) => {
    return a.displayName.localeCompare(b.displayName);
  });
---
<Nav />
<h1>Packages</h1>
{pkgs.map(pkg => (
    <h2><a href={`/packages/${pkg.name}`}>{pkg.displayName}</a></h2>
    <p>{pkg.description}</p>
    <p>Version: {pkg.version}</p>
))}
